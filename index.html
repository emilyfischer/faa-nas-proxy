<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pamela's Travel Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
  </style>
</head>
<body class="bg-white text-gray-900 min-h-screen">
  <div id="app"></div>

  <script type="module">
    const API_URL = 'https://faa-nas-proxy.vercel.app/api/nas-proxy';
    const FLIGHT_API_KEY = 'a9918f895f3cd554e7e4386460df8953';
    
    const AIRPORT_COORDS = {
      'ORD': { lat: 41.9742, lon: -87.9073, name: "Chicago O'Hare" },
      'JFK': { lat: 40.6413, lon: -73.7781, name: "JFK New York" },
      'LAX': { lat: 33.9416, lon: -118.4085, name: "Los Angeles" },
      'ATL': { lat: 33.6407, lon: -84.4277, name: "Atlanta" },
      'DFW': { lat: 32.8998, lon: -97.0403, name: "Dallas/Fort Worth" },
      'DEN': { lat: 39.8561, lon: -104.6737, name: "Denver" },
      'SFO': { lat: 37.6213, lon: -122.3790, name: "San Francisco" },
      'LAS': { lat: 36.0840, lon: -115.1537, name: "Las Vegas" },
      'PHX': { lat: 33.4352, lon: -112.0101, name: "Phoenix" },
      'MIA': { lat: 25.7959, lon: -80.2870, name: "Miami" },
      'BOS': { lat: 42.3656, lon: -71.0096, name: "Boston" },
      'SEA': { lat: 47.4502, lon: -122.3088, name: "Seattle" },
      'EWR': { lat: 40.6895, lon: -74.1745, name: "Newark" },
      'MCO': { lat: 28.4312, lon: -81.3081, name: "Orlando" },
      'CLT': { lat: 35.2144, lon: -80.9473, name: "Charlotte" }
    };
    
    let airports = [];
    let weather = {};
    let loading = true;
    let error = null;
    let filter = 'all';
    let searchQuery = '';
    let favorites = ['LAX', 'JFK'];
    let lastUpdate = null;
    let activeTab = 'airports';
    let trackedFlights = [];

    function getSeverity(airport) {
      if (!airport.status) return 'normal';
      if (airport.status.closureBegin || airport.status.groundStop) return 'severe';
      if (airport.status.groundDelay || airport.status.avgDelay) return 'moderate';
      return 'normal';
    }

    async function fetchWeather(iata) {
      const coords = AIRPORT_COORDS[iata];
      if (!coords) return null;
      
      try {
        const response = await fetch(
          `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current=temperature_2m,wind_speed_10m,weather_code&temperature_unit=fahrenheit&wind_speed_unit=mph`
        );
        const data = await response.json();
        return {
          temp: Math.round(data.current.temperature_2m),
          wind: Math.round(data.current.wind_speed_10m),
          code: data.current.weather_code
        };
      } catch (err) {
        return null;
      }
    }

    function getWeatherDescription(code) {
      if (code === 0) return '‚òÄÔ∏è Clear';
      if (code <= 3) return '‚õÖ Partly Cloudy';
      if (code <= 49) return 'üå´Ô∏è Fog';
      if (code <= 69) return 'üåßÔ∏è Rain';
      if (code <= 79) return 'üå®Ô∏è Snow';
      if (code <= 99) return '‚õàÔ∏è Thunderstorm';
      return 'üå§Ô∏è Unknown';
    }

    async function fetchNASData() {
      try {
        loading = true;
        error = null;
        render();
        
        const response = await fetch(API_URL);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const text = await response.text();
        const parser = new DOMParser();
        const xml = parser.parseFromString(text, 'text/xml');
        
        const parseError = xml.querySelector('parsererror');
        if (parseError) {
          throw new Error('XML parse error');
        }
        
        const airportData = [];
        
        const closures = xml.querySelectorAll('Airport_Closure_List Airport');
        closures.forEach(airport => {
          const iata = airport.querySelector('ARPT')?.textContent || '';
          airportData.push({
            IATA: iata,
            name: AIRPORT_COORDS[iata]?.name || '',
            status: {
              avgDelay: null,
              groundDelay: null,
              groundStop: null,
              closureBegin: airport.querySelector('Start')?.textContent || null,
              closureEnd: airport.querySelector('Reopen')?.textContent || null,
              reason: airport.querySelector('Reason')?.textContent || null
            }
          });
        });
        
        const groundDelays = xml.querySelectorAll('Ground_Delay_List Ground_Delay');
        groundDelays.forEach(delay => {
          const iata = delay.querySelector('ARPT')?.textContent || '';
          airportData.push({
            IATA: iata,
            name: AIRPORT_COORDS[iata]?.name || '',
            status: {
              avgDelay: delay.querySelector('Avg')?.textContent || null,
              groundDelay: delay.querySelector('Reason')?.textContent || null,
              groundStop: null,
              closureBegin: null,
              closureEnd: null,
              reason: delay.querySelector('Reason')?.textContent || null
            }
          });
        });
        
        const groundStops = xml.querySelectorAll('Ground_Stop_List Ground_Stop');
        groundStops.forEach(stop => {
          const iata = stop.querySelector('ARPT')?.textContent || '';
          airportData.push({
            IATA: iata,
            name: AIRPORT_COORDS[iata]?.name || '',
            status: {
              avgDelay: null,
              groundDelay: null,
              groundStop: stop.querySelector('Reason')?.textContent || null,
              closureBegin: null,
              closureEnd: null,
              reason: stop.querySelector('Reason')?.textContent || null
            }
          });
        });
        
        const delays = xml.querySelectorAll('Arrival_Departure_Delay_List Delay');
        delays.forEach(delay => {
          const iata = delay.querySelector('ARPT')?.textContent || '';
          airportData.push({
            IATA: iata,
            name: delay.querySelector('Name')?.textContent || AIRPORT_COORDS[iata]?.name || '',
            status: {
              avgDelay: delay.querySelector('Min')?.textContent ? 
                `${delay.querySelector('Min')?.textContent} - ${delay.querySelector('Max')?.textContent}` : null,
              groundDelay: null,
              groundStop: null,
              closureBegin: null,
              closureEnd: null,
              reason: delay.querySelector('Reason')?.textContent || null
            }
          });
        });
        
        const baseAirports = ['LAX', 'JFK'];
        for (const iata of baseAirports) {
          if (!airportData.find(a => a.IATA === iata)) {
            airportData.push({
              IATA: iata,
              name: AIRPORT_COORDS[iata]?.name || '',
              status: null
            });
          }
        }
        
        airports = airportData;
        
        const uniqueIatas = [...new Set(airportData.map(a => a.IATA))];
        for (const iata of uniqueIatas) {
          if (AIRPORT_COORDS[iata]) {
            const wx = await fetchWeather(iata);
            if (wx) {
              weather[iata] = wx;
            }
          }
        }
        
        lastUpdate = new Date();
        loading = false;
        render();
      } catch (err) {
        console.error('Fetch error:', err);
        error = '‚ö†Ô∏è Failed to load live data: ' + err.message;
        loading = false;
        render();
      }
    }

    function toggleFavorite(iata) {
      if (favorites.includes(iata)) {
        favorites = favorites.filter(f => f !== iata);
      } else {
        favorites.push(iata);
      }
      render();
    }

    function addFlight(traveler, flightNumber, from, to) {
      trackedFlights.push({ 
        traveler, 
        flightNumber: flightNumber.toUpperCase(), 
        from: from.toUpperCase(), 
        to: to.toUpperCase(), 
        id: Date.now() 
      });
      try {
        localStorage.setItem('trackedFlights', JSON.stringify(trackedFlights));
      } catch (e) {}
      render();
    }

    function removeFlight(id) {
      trackedFlights = trackedFlights.filter(f => f.id !== id);
      try {
        localStorage.setItem('trackedFlights', JSON.stringify(trackedFlights));
      } catch (e) {}
      render();
    }

    async function lookupFlight(flightNumber) {
      try {
        // Clean up the flight number but don't restrict format
        const cleanNumber = flightNumber.trim().toUpperCase().replace(/\s+/g, '');
        
        // Try the API with the flight number as-is
        const url = `https://api.aviationstack.com/v1/flights?access_key=${FLIGHT_API_KEY}&flight_iata=${cleanNumber}&limit=1`;
        const response = await fetch(url);
        
        if (!response.ok) {
          return null;
        }
        
        const data = await response.json();
        
        if (!data.data || data.data.length === 0) {
          return null;
        }
        
        const flight = data.data[0];
        return {
          from: flight.departure?.iata || null,
          to: flight.arrival?.iata || null
        };
      } catch (err) {
        console.error('Flight lookup error:', err);
        return null;
      }
    }

    async function showAddFlightForm() {
      const traveler = prompt('Who is traveling? (e.g., Emily, Mom, Sister)');
      if (!traveler) return;
      
      const flightNumber = prompt('Enter flight number (e.g., UA125, AA184, DL456)');
      if (!flightNumber) return;
      
      loading = true;
      render();
      
      const flightInfo = await lookupFlight(flightNumber.trim());
      
      loading = false;
      
      if (flightInfo && flightInfo.from && flightInfo.to) {
        addFlight(traveler, flightNumber.trim(), flightInfo.from, flightInfo.to);
        alert(`‚úÖ Found flight: ${flightInfo.from} ‚Üí ${flightInfo.to}`);
      } else {
        alert('‚ö†Ô∏è Could not find flight. Please enter route manually.');
        const route = prompt('Enter route (e.g., LAX-JFK or LAX to JFK)');
        if (!route) {
          render();
          return;
        }
        
        const routeParts = route.toUpperCase().split(/[-\s]+(?:TO\s+)?/);
        if (routeParts.length !== 2) {
          alert('Please enter route as: LAX-JFK or LAX to JFK');
          render();
          return;
        }
        
        const from = routeParts[0].trim();
        const to = routeParts[1].trim();
        addFlight(traveler, flightNumber.trim(), from, to);
      }
      
      render();
    }

    function getAirportStatus(iata) {
      const airport = airports.find(a => a.IATA === iata);
      if (!airport || !airport.status) {
        return { severity: 'normal', text: 'Normal Operations', airport: null };
      }
      
      const severity = getSeverity(airport);
      if (severity === 'severe') return { severity, text: 'üî¥ Severe Issues', airport };
      if (severity === 'moderate') return { severity, text: 'üü° Delays', airport };
      return { severity: 'normal', text: 'üü¢ Normal', airport };
    }

    function getFilteredAirports() {
      if (!airports.length) return [];
      
      let filtered = [...airports];
      
      if (filter === 'severe') {
        filtered = filtered.filter(a => getSeverity(a) === 'severe');
      } else if (filter === 'moderate') {
        filtered = filtered.filter(a => getSeverity(a) === 'moderate');
      } else if (filter === 'normal') {
        filtered = filtered.filter(a => getSeverity(a) === 'normal');
      } else if (filter === 'favorites') {
        filtered = filtered.filter(a => favorites.includes(a.IATA));
      }
      
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filtered = filtered.filter(a => 
          a.IATA.toLowerCase().includes(query) || 
          a.name.toLowerCase().includes(query)
        );
      }
      
      filtered.sort((a, b) => {
        const aFav = favorites.includes(a.IATA);
        const bFav = favorites.includes(b.IATA);
        if (aFav && !bFav) return -1;
        if (!aFav && bFav) return 1;
        
        const severityOrder = { severe: 0, moderate: 1, normal: 2 };
        const aSev = severityOrder[getSeverity(a)];
        const bSev = severityOrder[getSeverity(b)];
        if (aSev !== bSev) return aSev - bSev;
        
        return a.IATA.localeCompare(b.IATA);
      });
      
      return filtered;
    }

    function render() {
      const filteredAirports = getFilteredAirports();
      const severeCount = airports.filter(a => getSeverity(a) === 'severe').length;
      const moderateCount = airports.filter(a => getSeverity(a) === 'moderate').length;

      const html = [];
      
      html.push('<div class="bg-gray-100 shadow border-b border-gray-200">');
      html.push('  <div class="max-w-4xl mx-auto px-6 py-6">');
      html.push('    <div class="flex items-center justify-between mb-4">');
      html.push('      <div>');
      html.push('        <h1 class="text-3xl font-bold tracking-tight text-gray-900">Richardson Travel Hub</h1>');
      html.push('        <p class="text-gray-600 text-sm mt-1">');
      html.push(lastUpdate ? `Updated ${lastUpdate.toLocaleTimeString()}` : 'Loading...');
      html.push('        </p>');
      html.push('      </div>');
      html.push('      <button onclick="window.refreshData()" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded transition-all">');
      html.push('        <svg class="w-5 h-5' + (loading ? ' animate-spin' : '') + '" fill="none" stroke="currentColor" viewBox="0 0 24 24">');
      html.push('          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />');
      html.push('        </svg>');
      html.push('      </button>');
      html.push('    </div>');
      
      html.push('    <div class="flex gap-2 mb-4">');
      html.push('      <button onclick="window.setTab(\'airports\')" class="px-6 py-2 rounded font-medium transition-all ' + (activeTab === 'airports' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300') + '">');
      html.push('        üåê Airport Status');
      html.push('      </button>');
      html.push('      <button onclick="window.setTab(\'flights\')" class="px-6 py-2 rounded font-medium transition-all ' + (activeTab === 'flights' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300') + '">');
      html.push('        ‚úàÔ∏è My Flights' + (trackedFlights.length > 0 ? ` (${trackedFlights.length})` : ''));
      html.push('      </button>');
      html.push('    </div>');
      
      if (activeTab === 'airports') {
        html.push('    <div class="relative">');
        html.push('      <input type="text" placeholder="Search by airport code or name..." value="' + searchQuery + '" oninput="window.setSearch(this.value)" class="w-full bg-white border border-gray-300 text-gray-900 placeholder-gray-400 px-4 py-3 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />');
        html.push('      <svg class="absolute right-4 top-3.5 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">');
        html.push('        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />');
        html.push('      </svg>');
        html.push('    </div>');
      }
      
      html.push('  </div>');
      html.push('</div>');
      
      if (activeTab === 'airports') {
        html.push('<div class="max-w-4xl mx-auto px-6 py-4">');
        html.push('  <div class="flex gap-2 overflow-x-auto pb-2">');
        html.push('    <button onclick="window.setFilter(\'all\')" class="px-5 py-2 rounded font-medium whitespace-nowrap transition-all ' + (filter === 'all' ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300') + '">All (' + airports.length + ')</button>');
        if (favorites.length > 0) {
          html.push('    <button onclick="window.setFilter(\'favorites\')" class="px-5 py-2 rounded font-medium whitespace-nowrap transition-all ' + (filter === 'favorites' ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300') + '">‚≠ê Favorites (' + favorites.length + ')</button>');
        }
        html.push('    <button onclick="window.setFilter(\'severe\')" class="px-5 py-2 rounded font-medium whitespace-nowrap transition-all ' + (filter === 'severe' ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300') + '">üî¥ Severe (' + severeCount + ')</button>');
        html.push('    <button onclick="window.setFilter(\'moderate\')" class="px-5 py-2 rounded font-medium whitespace-nowrap transition-all ' + (filter === 'moderate' ? 'bg-yellow-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300') + '">üü° Moderate (' + moderateCount + ')</button>');
        html.push('    <button onclick="window.setFilter(\'normal\')" class="px-5 py-2 rounded font-medium whitespace-nowrap transition-all ' + (filter === 'normal' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300') + '">üü¢ Normal (' + (airports.length - severeCount - moderateCount) + ')</button>');
        html.push('  </div>');
        html.push('</div>');
      }
      
      html.push('<div class="max-w-4xl mx-auto px-6 pb-24">');
      
      if (error) {
        html.push('  <div class="bg-red-50 border border-red-300 rounded p-4 mb-4 flex items-center gap-3 text-red-800">');
        html.push('    <span>' + error + '</span>');
        html.push('  </div>');
      }
      
      if (activeTab === 'flights') {
        html.push('  <div class="mb-6">');
        html.push('    <button onclick="window.showAddFlightForm()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded transition-all flex items-center justify-center gap-2">');
        html.push('      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>');
        html.push('      Add Flight to Track');
        html.push('    </button>');
        html.push('  </div>');
        
        if (trackedFlights.length === 0) {
          html.push('  <div class="text-center py-12">');
          html.push('    <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>');
          html.push('    <h3 class="text-xl font-semibold mb-2 text-gray-900">No Flights Tracked</h3>');
          html.push('    <p class="text-gray-600">Click "Add Flight to Track" to monitor flights</p>');
          html.push('  </div>');
        } else {
          html.push('  <div class="space-y-4">');
          
          trackedFlights.forEach(flight => {
            const fromStatus = getAirportStatus(flight.from);
            const toStatus = getAirportStatus(flight.to);
            const fromWx = weather[flight.from];
            const toWx = weather[flight.to];
            const worstSeverity = fromStatus.severity === 'severe' || toStatus.severity === 'severe' ? 'severe' :
                                 fromStatus.severity === 'moderate' || toStatus.severity === 'moderate' ? 'moderate' : 'normal';
            
            const borderClass = worstSeverity === 'severe' ? 'border-2 border-red-500' : 
                            worstSeverity === 'moderate' ? 'border-2 border-yellow-500' : 'border border-gray-300';
            
            html.push('    <div class="bg-white rounded p-6 shadow ' + borderClass + '">');
            html.push('      <div class="flex items-start justify-between mb-4">');
            html.push('        <div>');
            html.push('          <h3 class="text-2xl font-bold text-gray-900">' + flight.flightNumber + '</h3>');
            html.push('          <p class="text-gray-600 text-sm mt-1">üë§ ' + flight.traveler + '</p>');
            html.push('        </div>');
            html.push('        <button onclick="window.removeFlight(' + flight.id + ')" class="text-red-600 hover:text-red-700 text-sm font-semibold px-3 py-1 rounded hover:bg-red-50">‚úï Remove</button>');
            html.push('      </div>');
            
            html.push('      <div class="flex items-center gap-4 mb-4">');
            html.push('        <div class="flex-1 bg-gray-50 border border-gray-200 rounded p-4">');
            html.push('          <div class="text-xs text-gray-500 mb-1">FROM</div>');
            html.push('          <div class="text-2xl font-bold text-gray-900">' + flight.from + '</div>');
            const fromColor = fromStatus.severity === 'severe' ? 'text-red-600' : fromStatus.severity === 'moderate' ? 'text-yellow-600' : 'text-green-600';
            html.push('          <div class="mt-2 text-sm font-medium ' + fromColor + '">' + fromStatus.text + '</div>');
            if (fromWx) {
              html.push('          <div class="text-xs text-gray-600 mt-2">' + getWeatherDescription(fromWx.code) + ' ‚Ä¢ ' + fromWx.temp + '¬∞F ‚Ä¢ ' + fromWx.wind + ' mph</div>');
            }
            html.push('        </div>');
            html.push('        <div class="text-3xl">‚úàÔ∏è</div>');
            html.push('        <div class="flex-1 bg-gray-50 border border-gray-200 rounded p-4">');
            html.push('          <div class="text-xs text-gray-500 mb-1">TO</div>');
            html.push('          <div class="text-2xl font-bold text-gray-900">' + flight.to + '</div>');
            const toColor = toStatus.severity === 'severe' ? 'text-red-600' : toStatus.severity === 'moderate' ? 'text-yellow-600' : 'text-green-600';
            html.push('          <div class="mt-2 text-sm font-medium ' + toColor + '">' + toStatus.text + '</div>');
            if (toWx) {
              html.push('          <div class="text-xs text-gray-600 mt-2">' + getWeatherDescription(toWx.code) + ' ‚Ä¢ ' + toWx.temp + '¬∞F ‚Ä¢ ' + toWx.wind + ' mph</div>');
            }
            html.push('        </div>');
            html.push('      </div>');
            
            if ((fromStatus.airport && fromStatus.airport.status) || (toStatus.airport && toStatus.airport.status)) {
              html.push('      <div class="space-y-2 text-sm">');
              if (fromStatus.airport && fromStatus.airport.status && fromStatus.airport.status.reason) {
                html.push('        <div class="bg-gray-50 border border-gray-200 rounded p-3">');
                html.push('          <span class="text-gray-700 font-semibold">' + flight.from + ': </span>');
                html.push('          <span class="text-gray-600">' + fromStatus.airport.status.reason + '</span>');
                html.push('        </div>');
              }
              if (toStatus.airport && toStatus.airport.status && toStatus.airport.status.reason) {
                html.push('        <div class="bg-gray-50 border border-gray-200 rounded p-3">');
                html.push('          <span class="text-gray-700 font-semibold">' + flight.to + ': </span>');
                html.push('          <span class="text-gray-600">' + toStatus.airport.status.reason + '</span>');
                html.push('        </div>');
              }
              html.push('      </div>');
            }
            
            html.push('    </div>');
          });
          
          html.push('  </div>');
        }
      } else {
        if (loading && airports.length === 0) {
          html.push('  <div class="flex items-center justify-center py-12">');
          html.push('    <svg class="w-8 h-8 animate-spin text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>');
          html.push('  </div>');
        } else if (filteredAirports.length === 0) {
          html.push('  <div class="text-center py-12">');
          html.push('    <svg class="w-12 h-12 mx-auto mb-4 opacity-50 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>');
          html.push('    <p class="text-gray-600 text-lg">No airports found</p>');
          if (searchQuery) {
            html.push('    <p class="text-gray-500 text-sm mt-2">Try a different search term</p>');
          }
          html.push('  </div>');
        } else {
          html.push('  <div class="space-y-3">');
          
          filteredAirports.forEach(airport => {
            const severity = getSeverity(airport);
            const isFavorite = favorites.includes(airport.IATA);
            const wx = weather[airport.IATA];
            
            const borderClass = severity === 'severe' ? 'border-2 border-red-500' : severity === 'moderate' ? 'border-2 border-yellow-500' : 'border border-gray-300';
            const statusBadge = severity === 'severe' ? 'bg-red-600 text-white' : severity === 'moderate' ? 'bg-yellow-500 text-white' : 'bg-green-600 text-white';
            const statusText = severity === 'severe' ? 'üî¥ SEVERE' : severity === 'moderate' ? 'üü° DELAYS' : 'üü¢ NORMAL';
            
            html.push('    <div class="bg-white rounded p-5 shadow ' + borderClass + '">');
            html.push('      <div class="flex items-start justify-between mb-3">');
            html.push('        <div class="flex-1">');
            html.push('          <div class="flex items-center gap-2">');
            html.push('            <button onclick="window.toggleFavorite(\'' + airport.IATA + '\')" class="text-2xl hover:scale-110 transition-transform">');
            html.push(isFavorite ? '‚≠ê' : '‚òÜ');
            html.push('            </button>');
            html.push('            <h3 class="text-2xl font-bold text-gray-900">' + airport.IATA + '</h3>');
            html.push('          </div>');
            if (airport.name) {
              html.push('          <p class="text-gray-600 text-sm ml-9">' + airport.name + '</p>');
            }
            if (wx) {
              html.push('          <div class="flex items-center gap-4 mt-2 ml-9 text-sm text-gray-600">');
              html.push('            <span>' + getWeatherDescription(wx.code) + '</span>');
              html.push('            <span>üå°Ô∏è ' + wx.temp + '¬∞F</span>');
              html.push('            <span>üí® ' + wx.wind + ' mph</span>');
              html.push('          </div>');
            }
            html.push('        </div>');
            html.push('        <div class="px-3 py-1 rounded text-xs font-semibold ' + statusBadge + '">' + statusText + '</div>');
            html.push('      </div>');
            
            if (airport.status) {
              html.push('      <div class="space-y-2 text-sm">');
              if (airport.status.avgDelay) {
                html.push('        <div class="flex justify-between items-center bg-gray-50 border border-gray-200 rounded p-3">');
                html.push('          <span class="text-gray-600">Average Delay</span>');
                html.push('          <span class="font-semibold text-gray-900">' + airport.status.avgDelay + '</span>');
                html.push('        </div>');
              }
              if (airport.status.groundDelay) {
                html.push('        <div class="flex justify-between items-center bg-gray-50 border border-gray-200 rounded p-3">');
                html.push('          <span class="text-gray-600">Ground Delay</span>');
                html.push('          <span class="font-semibold text-gray-900">' + airport.status.groundDelay + '</span>');
                html.push('        </div>');
              }
              if (airport.status.groundStop) {
                html.push('        <div class="flex justify-between items-center bg-red-50 border border-red-300 rounded p-3">');
                html.push('          <span class="text-red-700">‚õî Ground Stop</span>');
                html.push('          <span class="font-semibold text-red-900">' + airport.status.groundStop + '</span>');
                html.push('        </div>');
              }
              if (airport.status.closureBegin) {
                html.push('        <div class="bg-red-50 border border-red-300 rounded p-3">');
                html.push('          <div class="flex justify-between items-center mb-1">');
                html.push('            <span class="text-red-700">üö´ Closure Begin</span>');
                html.push('            <span class="font-semibold text-red-900">' + airport.status.closureBegin + '</span>');
                html.push('          </div>');
                if (airport.status.closureEnd) {
                  html.push('          <div class="flex justify-between items-center">');
                  html.push('            <span class="text-red-700">Closure End</span>');
                  html.push('            <span class="font-semibold text-red-900">' + airport.status.closureEnd + '</span>');
                  html.push('          </div>');
                }
                html.push('        </div>');
              }
              if (airport.status.reason) {
                html.push('        <div class="bg-gray-50 border border-gray-200 rounded p-3">');
                html.push('          <span class="text-gray-600 text-xs">Reason: </span>');
                html.push('          <span class="text-sm text-gray-900">' + airport.status.reason + '</span>');
                html.push('        </div>');
              }
              html.push('      </div>');
            }
            
            html.push('    </div>');
          });
          
          html.push('  </div>');
        }
      }
      
      html.push('</div>');
      
      html.push('<div class="fixed bottom-0 left-0 right-0 bg-gray-100 border-t border-gray-200 shadow">');
      html.push('  <div class="max-w-4xl mx-auto px-6 py-4">');
      html.push('    <div class="flex items-center justify-between text-sm">');
      html.push('      <div class="text-gray-600">');
      if (activeTab === 'airports') {
        html.push('        Showing ' + filteredAirports.length + ' of ' + airports.length + ' airports');
      } else {
        html.push('        Tracking ' + trackedFlights.length + ' flight' + (trackedFlights.length !== 1 ? 's' : ''));
      }
      html.push('      </div>');
      html.push('      <div class="text-gray-500 text-xs">Auto-refresh: 60s</div>');
      html.push('    </div>');
      html.push('  </div>');
      html.push('</div>');
      
      document.getElementById('app').innerHTML = html.join('');
    }

    window.refreshData = fetchNASData;
    window.setFilter = (newFilter) => {
      filter = newFilter;
      render();
    };
    window.setSearch = (query) => {
      searchQuery = query;
      render();
    };
    window.toggleFavorite = toggleFavorite;
    window.setTab = (tab) => {
      activeTab = tab;
      render();
    };
    window.showAddFlightForm = showAddFlightForm;
    window.removeFlight = removeFlight;

    try {
      const saved = localStorage.getItem('trackedFlights');
      if (saved) {
        trackedFlights = JSON.parse(saved);
      }
    } catch (e) {}

    fetchNASData();
    setInterval(fetchNASData, 60000);
  </script>
</body>
</html>
